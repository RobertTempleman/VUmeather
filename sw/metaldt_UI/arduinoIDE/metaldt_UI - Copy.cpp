// metaldt_UI.cpp : Defines the entry point for the application.
//

#include "stdafx.h"
#include "metaldt_UI.h"
#include "GBAtext.h"
#include "RTTcolours.h"
#include <stdio.h>
#include <math.h>

#define MAX_LOADSTRING 100

// Global Variables:
HINSTANCE hInst;								// current instance
TCHAR szTitle[MAX_LOADSTRING];					// The title bar text
TCHAR szWindowClass[MAX_LOADSTRING];			// the main window class name

void drawit();
void draw_background();
void one_second_update_counter();


#define eigen 2

int offx=300;
int offy=150;
HDC ghdc;
DWORD gcol;
void win_pc(int x,int y,DWORD col){
  x*=eigen;
  y*=eigen;
  x+=offx;
  y+=offy;
//  SetPixelV(ghdc,x,y,col);
  for(int i=0;i<eigen;i++){
    for(int j=0;j<eigen;j++){
      SetPixelV(ghdc,x+i,y+j,col);
    }
  }
}



void win_drawit(HDC hdc){
  ghdc=hdc;
  HPEN stock_dc_pen=CreatePen(PS_SOLID, 1, green6_cr);
  HGDIOBJ old_pen=SelectObject(hdc,stock_dc_pen);
  HBRUSH stock_dc_brush=CreateSolidBrush(0);
  HGDIOBJ old=SelectObject(hdc,stock_dc_brush);
  static int once=1;
  if (once){
    once=0;
    Rectangle(hdc,0,0,1600,1000);
    draw_background();
  }
  drawit();
  SelectObject(hdc,old_pen);
  SelectObject(hdc,old);
  DeleteObject(stock_dc_brush);
  DeleteObject(stock_dc_pen);
}



// Forward declarations of functions included in this code module:
ATOM				MyRegisterClass(HINSTANCE hInstance);
BOOL				InitInstance(HINSTANCE, int);
LRESULT CALLBACK	WndProc(HWND, UINT, WPARAM, LPARAM);
INT_PTR CALLBACK	About(HWND, UINT, WPARAM, LPARAM);

int APIENTRY _tWinMain(_In_ HINSTANCE hInstance,
                     _In_opt_ HINSTANCE hPrevInstance,
                     _In_ LPTSTR    lpCmdLine,
                     _In_ int       nCmdShow)
{
	UNREFERENCED_PARAMETER(hPrevInstance);
	UNREFERENCED_PARAMETER(lpCmdLine);

 	// TODO: Place code here.
	MSG msg;
	HACCEL hAccelTable;

	// Initialize global strings
	LoadString(hInstance, IDS_APP_TITLE, szTitle, MAX_LOADSTRING);
	LoadString(hInstance, IDC_metaldt_UI, szWindowClass, MAX_LOADSTRING);
	MyRegisterClass(hInstance);

	// Perform application initialization:
	if (!InitInstance (hInstance, nCmdShow))
	{
		return FALSE;
	}

	hAccelTable = LoadAccelerators(hInstance, MAKEINTRESOURCE(IDC_metaldt_UI));

	// Main message loop:
	while (GetMessage(&msg, NULL, 0, 0))
	{
		if (!TranslateAccelerator(msg.hwnd, hAccelTable, &msg))
		{
			TranslateMessage(&msg);
			DispatchMessage(&msg);
		}
	}

	return (int) msg.wParam;
}



//
//  FUNCTION: MyRegisterClass()
//
//  PURPOSE: Registers the window class.
//
ATOM MyRegisterClass(HINSTANCE hInstance)
{
	WNDCLASSEX wcex;

	wcex.cbSize = sizeof(WNDCLASSEX);

	wcex.style			= CS_HREDRAW | CS_VREDRAW;
	wcex.lpfnWndProc	= WndProc;
	wcex.cbClsExtra		= 0;
	wcex.cbWndExtra		= 0;
	wcex.hInstance		= hInstance;
	wcex.hIcon			= LoadIcon(hInstance, MAKEINTRESOURCE(IDI_metaldt_UI));
	wcex.hCursor		= LoadCursor(NULL, IDC_ARROW);
	wcex.hbrBackground	= (HBRUSH)(COLOR_WINDOW+1);
	wcex.lpszMenuName	= MAKEINTRESOURCE(IDC_metaldt_UI);
	wcex.lpszClassName	= szWindowClass;
	wcex.hIconSm		= LoadIcon(wcex.hInstance, MAKEINTRESOURCE(IDI_SMALL));

	return RegisterClassEx(&wcex);
}








////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#define NUM_SBM20S 4
#define NUM_TUBES (NUM_SBM20S+1)

float scale[NUM_TUBES]={1.f,15.f,300.f,2000.1f};
float da[NUM_TUBES]={0.1f,0.23f,2.f,1.11f};
int counts[NUM_TUBES];
DWORD start_ticks;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//
//   FUNCTION: InitInstance(HINSTANCE, int)
//
//   PURPOSE: Saves instance handle and creates main window
//
//   COMMENTS:
//
//        In this function, we save the instance handle in a global variable and
//        create and display the main program window.
//
BOOL InitInstance(HINSTANCE hInstance, int nCmdShow)
{
   HWND hWnd;
   start_ticks=GetTickCount();
   hInst = hInstance; // Store instance handle in our global variable

   hWnd = CreateWindow(szWindowClass, szTitle, WS_OVERLAPPEDWINDOW,
      CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, NULL, NULL, hInstance, NULL);

   if (!hWnd)
   {
      return FALSE;
   }

   ShowWindow(hWnd, nCmdShow);
   UpdateWindow(hWnd);
   for(int i=1;i<5;i++){
     SetTimer(hWnd,i,10,0);
   }

   SetTimer(hWnd,10,500,0);
   SetTimer(hWnd,5,500,0);

   return TRUE;
}

//
//  FUNCTION: WndProc(HWND, UINT, WPARAM, LPARAM)
//
//  PURPOSE:  Processes messages for the main window.
//
//  WM_COMMAND	- process the application menu
//  WM_PAINT	- Paint the main window
//  WM_DESTROY	- post a quit message and return
//
//
LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)
{
	int wmId, wmEvent;
	PAINTSTRUCT ps;
	HDC hdc;
  static float a=0;

	switch (message)
	{
	case WM_COMMAND:
		wmId    = LOWORD(wParam);
		wmEvent = HIWORD(wParam);
		// Parse the menu selections:
		switch (wmId)
		{
		case IDM_ABOUT:
			DialogBox(hInst, MAKEINTRESOURCE(IDD_ABOUTBOX), hWnd, About);
			break;
		case IDM_EXIT:
			DestroyWindow(hWnd);
			break;
		default:
			return DefWindowProc(hWnd, message, wParam, lParam);
		}
		break;
	case WM_PAINT:
		hdc = BeginPaint(hWnd, &ps);
		// TODO: Add any drawing code here...
    win_drawit(hdc);
		EndPaint(hWnd, &ps);
		break;
  case WM_TIMER:
    switch(wParam){
      case 1:
        counts[wParam-1]+=1+(int)fabsf((150.0f*(1.1f+sinf(a)+cosf(a*3.21f)+1.1f*sinf(a*1.123243f)*cosf(.2132132f*a))));
        a+=0.004f;
        break;
      case 2:
        counts[wParam-1]+=1+(int)fabsf((2.0f*(1.1f+sinf(a)+cosf(a*1.21f)+1.4f*sinf(a*1.123243f)*cosf(.2132132f*a))));
        a+=0.005f;
        break;
      case 3:
        if (((rand()*1000)/RAND_MAX)<100){
          counts[wParam-1]+=1+(int)fabsf((1.0f*(1.1f+sinf(a)+cosf(a*2.21f)+2.0f*sinf(a*1.123243f)*cosf(.2132132f*a))));
        }
        a+=0.003f;
        break;
      case 4:
        if (((rand()*1000)/RAND_MAX)<3){
          counts[wParam-1]++;
        }
        break;
      case 10:
        InvalidateRect(hWnd,0,FALSE);
        break;
      case 5:
        {
          one_second_update_counter();
        }
        break;
    }
    break;
	case WM_DESTROY:
		PostQuitMessage(0);
		break;
	default:
		return DefWindowProc(hWnd, message, wParam, lParam);
	}
	return 0;
}

// Message handler for about box.
INT_PTR CALLBACK About(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)
{
	UNREFERENCED_PARAMETER(lParam);
	switch (message)
	{
	case WM_INITDIALOG:
		return (INT_PTR)TRUE;

	case WM_COMMAND:
		if (LOWORD(wParam) == IDOK || LOWORD(wParam) == IDCANCEL)
		{
			EndDialog(hDlg, LOWORD(wParam));
			return (INT_PTR)TRUE;
		}
		break;
	}
	return (INT_PTR)FALSE;
}





///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





#define NUM_HISTORIES 60

typedef unsigned char u8;
typedef unsigned short u16;
typedef unsigned int u32;

float microsieverts[NUM_SBM20S]={0,0,0,0};

float counts_smoothed_1s[NUM_TUBES]={0,0,0,0};
int counts_last_1m[NUM_TUBES]={0,0,0,0};
int counts_per_1s[NUM_TUBES]={0,0,0,0};
int counts_per_min[NUM_TUBES]={0,0,0,0};
int counts_per_hour[NUM_TUBES]={0,0,0,0};

int history_counts_per_1s[NUM_TUBES][NUM_HISTORIES];
int history_counts_per_min[NUM_TUBES][NUM_HISTORIES];

float tube_voltage=0;
float battery_voltage=0;

#define LINE_HEIGHT 6


#define CPM_TO_MICROSIEVERTS 175.43f

#define MICROSIEVERTS_FOR_FULL_BAR_HEIGHT 1.0f
#define CURRENT_COUNT_BAR_X 49
#define CURRENT_COUNT_BAR_Y 24 // bottom of bar
#define CURRENT_COUNT_BAR_W 13
#define CURRENT_COUNT_BAR_H 22

#define GRAPH_SECONDS_X 3
#define GRAPH_SECONDS_Y 47   // bottom of the graph
#define GRAPH_SECONDS_W 59
#define GRAPH_SECONDS_H 21

#define GRAPH_MINUTES_X 3
#define GRAPH_MINUTES_Y 62   // bottom of the graph
#define GRAPH_MINUTES_W 59
#define GRAPH_MINUTES_H 13



void pc(int x,int y,DWORD col){
  win_pc(x,y,col);
}

inline void p(int x, int y){
  win_pc(x,y,gcol);
}

void hline(int x,int y,int w){
  for(int i=x;i<=x+w;i++){
    p(i,y);
  }
}

void vline(int x,int y,int h){
  for(int i=y-h;i<=y;i++){
    p(x,i);
  }
}

void rectfill(int x,int y,int w,int h){
  for(int i=x;i<=x+w;i++){
    vline(i,y,h);
  }
}

void rect(int x,int y,int w,int h){
  hline(x  ,y  ,w);
  hline(x  ,y+h,w);
  vline(x  ,y+h-1,h-2);
  vline(x+w,y+h-1,h-2);
}



void draw_graph_axis(int graph_x,int graph_y,int graph_h){
  int x=graph_x-2;
  hline(x,graph_y,2);
  hline(x,graph_y-graph_h,2);
  hline(x,graph_y-(graph_h>>1),2);
  vline(x+1,graph_y,graph_h);
}



void draw_tube_background(int orig_x,int orig_y,int wx,int wy,int tube){
  gcol=green8_cr;
  rect(orig_x,orig_y,wx-1,wy-1);
  int y=orig_y+2;
  print_pretty(orig_x,y,"c/S",grey65_cr,coral2_cr,green3_cr,false,false,true);y+=LINE_HEIGHT;
  print_pretty(orig_x,y,"c/\"#",grey65_cr,coral2_cr,green3_cr,false,false,true);y+=LINE_HEIGHT;
  print_pretty(orig_x,y,"&'$/h",grey65_cr,coral2_cr,green3_cr,false,false,true);y+=LINE_HEIGHT;
  print_pretty(orig_x,y,"&'$/h",grey65_cr,coral2_cr,green3_cr,false,false,true);y+=LINE_HEIGHT;
  gcol=lightblue4_cr;
  draw_graph_axis(orig_x+GRAPH_SECONDS_X,orig_y+GRAPH_SECONDS_Y,GRAPH_SECONDS_H);
  draw_graph_axis(orig_x+GRAPH_MINUTES_X,orig_y+GRAPH_MINUTES_Y,GRAPH_MINUTES_H);
}



void plot_numbert_float(int orig_x,int &y,float n,COLORREF col2,bool int_if_less_than_1000=false){
  char rtt[10];
  if (n<1000.0f){
    if (int_if_less_than_1000){
      sprintf(rtt,"%6d ",(int)n);
    }else{
      if (n<1.0f)
        sprintf(rtt,"%6.3f ",n);
      if (n<10.0f){
        sprintf(rtt,"%6.2f ",n);
      }else if (n<100.0f){
        sprintf(rtt,"%6.1f ",n);
      }else if (n<1000.f){
        sprintf(rtt,"%6.0f ",n);
      }
    }
  }else{
    n*=0.001f;
    if (n<1.0f)
      sprintf(rtt,"%6.3fk",n);
    if (n<10.0f){
      sprintf(rtt,"%6.2fk",n);
    }else if (n<100.0f){
      sprintf(rtt,"%6.1fk",n);
    }else if (n<1000.f){
      sprintf(rtt,"%6.0fk",n);
    }else{
      sprintf(rtt,"%6.3fM",n*0.001f);
    }
  }
  print_pretty(orig_x+20,y,rtt,grey65_cr,col2,green3_cr);y+=LINE_HEIGHT;
}



void vline_clipped_for_graph(int x,int y,int h,int graph_top_y,int clip_w){
  // clip the graph drawing around the axis value
  bool draw=true;
  if (x<clip_w){
    if (y<=graph_top_y){
      draw=false;
    }else{
      int clip_y=graph_top_y+6;
      if (y-h<clip_y){
        h=y-clip_y;
      }
    }
  }
  if (draw){
    vline(x,y,h);
  }
}



void do_a_graph(int graph_x,int graph_y,int graph_w,int graph_h,int *values,COLORREF col_lines,COLORREF col_background,COLORREF col_text){
  int max_val=1;
  for(int i=0;i<NUM_HISTORIES;i++){
    int c=values[i];
    if (c>max_val){
      max_val=c;
    }
  }
  // draw text first to ger everything
  int clip_w;
  char *format;
  if (max_val<10){
    format="%1d";
    clip_w=1;
  }else if (max_val<100){
    format="%2d";
    clip_w=2;
  }else if (max_val<1000){
    format="%3d";
    clip_w=3;
  }else if (max_val<10000){
    format="%4d";
    clip_w=4;
  }else if (max_val<100000){
    format="%5d";
    clip_w=5;
  }else if (max_val<1000000){
    format="%6d";
    clip_w=6;
  }else{
    format="%7d";
    clip_w=7;
  }
  clip_w=clip_w*4+graph_x+2;
  char rtt[16];
  sprintf(rtt,format,max_val);
  print_pretty(graph_x+1,graph_y-graph_h,rtt,col_text,col_text,col_text);

  for(int i=0;i<=graph_w;i++){
    int h=(graph_h*values[graph_w-i])/max_val;
    int x=graph_x+i;
    gcol=col_lines;
    if (h){
      vline_clipped_for_graph(x,graph_y,h,graph_y-graph_h,clip_w);
    }
    gcol=col_background;
    if (h<=graph_h){
      if (graph_h-h){
        int extra_background=h?1:0;
        vline_clipped_for_graph(x,graph_y-h-extra_background,graph_h-h-extra_background,graph_y-graph_h,clip_w);
      }
    }
  }
}



void draw_tube(int orig_x,int orig_y,int wx,int wy,int tube){
  char rtt[16];
  int y=orig_y+2;
  int cps=counts_per_1s[tube];
  if (cps==0){
    plot_numbert_float(orig_x,y,counts_smoothed_1s[tube],lightblue_cr);
  }else{
    sprintf(rtt,"%6d",counts_per_1s[tube]);
    print_pretty(orig_x+20,y,rtt,grey65_cr,lightblue_cr,green3_cr);y+=LINE_HEIGHT;
  }
  plot_numbert_float(orig_x,y,(float)counts_last_1m[tube],white_cr,true);
  float us_10s_timeperiod=counts_smoothed_1s[tube]*60.0f/CPM_TO_MICROSIEVERTS;
  microsieverts[tube]=us_10s_timeperiod;
  plot_numbert_float(orig_x,y,us_10s_timeperiod,coral2_cr);
  float us=counts_last_1m[tube]/CPM_TO_MICROSIEVERTS;
  plot_numbert_float(orig_x,y,us,coral2_cr);


  int bar_h=(int)(us*CURRENT_COUNT_BAR_H/(float)MICROSIEVERTS_FOR_FULL_BAR_HEIGHT);
  gcol=green5_cr;
  if (bar_h>CURRENT_COUNT_BAR_H){
    bar_h/=CURRENT_COUNT_BAR_H;
    gcol=grey40_cr;
  }
  if (bar_h>CURRENT_COUNT_BAR_H){
    bar_h/=CURRENT_COUNT_BAR_H;
    gcol=orange3_cr;
  }
  if (bar_h>CURRENT_COUNT_BAR_H){
    bar_h/=CURRENT_COUNT_BAR_H;
    gcol=red_cr;
  }
  if (bar_h>CURRENT_COUNT_BAR_H){
    bar_h/=CURRENT_COUNT_BAR_H;
    gcol=white_cr;
  }
  int x=orig_x+CURRENT_COUNT_BAR_X;
  y=orig_y+CURRENT_COUNT_BAR_Y;
  rectfill(x,y,CURRENT_COUNT_BAR_W,bar_h);
  if (bar_h<=CURRENT_COUNT_BAR_H){
    gcol=grey15_cr;
    rectfill(x,y-bar_h-1,CURRENT_COUNT_BAR_W,CURRENT_COUNT_BAR_H-bar_h);
  }

  do_a_graph(orig_x+GRAPH_SECONDS_X,orig_y+GRAPH_SECONDS_Y,GRAPH_SECONDS_W,GRAPH_SECONDS_H,history_counts_per_1s[tube],white_cr,grey10_cr,goldenrod_cr);
  do_a_graph(orig_x+GRAPH_MINUTES_X,orig_y+GRAPH_MINUTES_Y,GRAPH_MINUTES_W,GRAPH_MINUTES_H,history_counts_per_min[tube],steelblue3_cr,darkblue_cr,goldenrod2_cr);
}



// return sum of history array
int update_history(int val,int* history,int num){
  int t=0;
  for(int i=num-1;i>0;i--){
    int h=history[i-1];
    history[i]=h;
    t+=h;
  }
  history[0]=val;
  return t;
}




#define SMOOTHING_TIME_PERIOD 10
#define EMA_ALPHA (2.0f/(SMOOTHING_TIME_PERIOD+1))


void one_second_update_counter(){
  static short counter_min=60;
  // 1s timer
  int t=0;
  // add up counts from last second
  for(int i=0;i<NUM_SBM20S;i++){
    int c=counts[i];
    counts[i]=0;
    counts_per_1s[i]=c;
    counts_per_min[i]+=c;
    t+=c;
  }
  counts_per_1s[NUM_SBM20S]=t;
  counts_per_min[NUM_SBM20S]+=t;

  for(int i=0;i<NUM_TUBES;i++){
    int c=counts_per_1s[i];
    counts_last_1m[i]=update_history(c,history_counts_per_1s[i],NUM_HISTORIES);
    counts_smoothed_1s[i]=(1.0f-EMA_ALPHA)*(float)counts_smoothed_1s[i]+EMA_ALPHA*(float)c;
  }

  counter_min--;
  if (counter_min==0){
    counter_min=60;
    for(int i=0;i<NUM_TUBES;i++){
      int c=counts_per_min[i];
      counts_per_min[i]=0;
      update_history(c,history_counts_per_min[i],NUM_HISTORIES);
    }
  }
}




// bookman_oldstyle chars 0123456789uSvph
#define CHAR_IMAGE_WIDTH 13
#define CHAR_PLOT_WIDTH 10
#define CHAR_PLOT_HEIGHT 13
#define CHAR_IMAGE_STRIDE 182
u8 big_font[]={
  0x00,0x00,0x09,0x64,0x93,0x7f,0x28,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x4a,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1a,0x72,0x93,0x82,0x3c
  ,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1b,0x74,0x95,0x85,0x3c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x51,0x0e,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x09,0x78,0x5a,0x35,0x24,0x3b,0x78,0x12,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x19,0x70,0x96,0x79,0x23,0x00,0x00,0x00,0x00,0x00,0x00,0x3f,0x76,0x5c,0x5c,0x5c
  ,0x5b,0x5c,0x49,0x01,0x00,0x00,0x00,0x00,0x00,0x07,0x61,0x95,0x90,0x54,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x12,0x6b,0x95,0x81,0x2d,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x65,0x6f,0x5c,0x28,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0xb9,0xfa,0xb5,0xd9,0xe6,0x4d,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x1b,0x5d,0x90,0xdc,0xda,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0xd9,0xd6,0xb9,0xe5,0xfa,0x87,0x01,0x00,0x00,0x00,0x00,0x00,0x2c,0xd5,0xcf
  ,0xae,0xdb,0xf8,0x74,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7e,0xff,0x2c,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0xff,0xff,0xff,0xfa,0xff,0xd5,0x0e,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x42,0xdc,0xe5,0xb0,0xea,0xdc,0x33,0x00,0x00,0x00,0x00,0x00,0x94,0xff,0xff,0xff,0xff,0xff,0xff,0xbf,0x02,0x00,0x00,0x00,0x00,0x13,0xb8
  ,0xe4,0xa9,0xba,0xfc,0xa9,0x09,0x00,0x00,0x00,0x00,0x00,0x23,0xcc,0xfa,0xb4,0xda,0xec,0x59,0x00,0x00,0x00,0x00,0x00,0x00,0x54,0xb0,0x02,0x00,0x00,0x81,0xa2,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x00,0x90,0xbb,0x71,0x5b,0x8a,0xbb,0x76,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x8e,0x3c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x8b,0xff,0x66,0x00,0x19,0xe2,0xe5,0x1c,0x00,0x00,0x00,0x00,0x00,0x58,0xde,0xeb,0xff,0xd4,0x09,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x07,0xd4,0xa5,0x03,0x00,0x1e,0xdd,0xff,0x41,0x00,0x00,0x00,0x00,0x00,0x9d,0xff,0x43,0x00,0x17,0xe4,0xf8,0x27,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x38,0xf1,0xf7,0x29,0x00,0x00,0x00,0x00,0x00,0x00,0x1d,0xe7,0xc4,0xd4,0xd2,0xa1,0x24,0x00,0x00,0x00,0x00,0x00,0x00,0x21,0xe4,0xe0,0x22,0x00,0xde
  ,0xff,0x86,0x00,0x00,0x00,0x00,0x00,0xb5,0xd8,0x83,0x81,0x81,0x99,0xff,0x56,0x00,0x00,0x00,0x00,0x00,0x89,0xff,0x32,0x00,0x00,0x7f,0xff,0x5c,0x00,0x00,0x00,0x00
  ,0x05,0xbc,0xff,0x5f,0x00,0x15,0xd3,0xec,0x26,0x00,0x00,0x00,0x00,0x00,0x58,0xb3,0x04,0x00,0x00,0x85,0xa7,0x00,0x00,0x00,0x00,0x00,0x00,0x82,0xbb,0x04,0x00,0x00
  ,0x00,0x67,0x75,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x9e,0x49,0x7d,0x94,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x11,0xe6,0xe8,0x0f,0x00,0x00,0x93,0xff,0x72,0x00,0x00,0x00,0x00,0x00,0x05,0x0c,0x1a,0xe6,0xd7,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x21,0xff,0xc5,0x38,0x00
  ,0x00,0xa6,0xff,0x75,0x00,0x00,0x00,0x00,0x00,0xaf,0xff,0x9a,0x00,0x00,0xb7,0xff,0x51,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0xca,0xff,0xef,0x29,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x30,0xd8,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x8d,0xff,0x72,0x00,0x03,0xc1,0xea,0x52,0x00,0x00,0x00,0x00,0x08,0xe0,0x79,0x00
  ,0x00,0x00,0x83,0xca,0x03,0x00,0x00,0x00,0x00,0x00,0xc1,0xe8,0x03,0x00,0x00,0x3d,0xff,0x7c,0x00,0x00,0x00,0x00,0x33,0xff,0xe4,0x0c,0x00,0x00,0x76,0xff,0x7c,0x00
  ,0x00,0x00,0x00,0x00,0x56,0xb3,0x03,0x00,0x00,0x82,0xa3,0x00,0x00,0x00,0x00,0x00,0x00,0xbb,0x89,0x00,0x00,0x00,0x00,0x28,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x67,0x62,0x00,0x85,0xa3,0x00,0x00,0x00,0x00,0x00,0x00,0x45,0xff,0xc7,0x03,0x00,0x00,0x69,0xff,0xaa
  ,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0xe1,0xd8,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x15,0xea,0xff,0xa4,0x00,0x01,0xc9,0xff,0x6a,0x00,0x00,0x00,0x00,0x00,0x44
  ,0xa5,0x3f,0x00,0x00,0xc9,0xff,0x35,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x8e,0xe3,0xd5,0xf8,0x29,0x00,0x00,0x00,0x00,0x00,0x00,0x41,0xd0,0x4e,0x68,0x59,0x1d,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x0b,0xdd,0xf5,0x1b,0x00,0x08,0x10,0x16,0x00,0x00,0x00,0x00,0x00,0x10,0xc9,0x37,0x00,0x00,0x20,0xf0,0x61,0x00,0x00,0x00,0x00,0x00,0x00
  ,0xb3,0xff,0x9e,0x25,0x02,0x8a,0xfc,0x3e,0x00,0x00,0x00,0x00,0x53,0xff,0xd5,0x05,0x00,0x00,0x5d,0xff,0xad,0x00,0x00,0x00,0x00,0x00,0x57,0xb3,0x04,0x00,0x00,0x82
  ,0xa3,0x00,0x00,0x00,0x00,0x00,0x00,0xbb,0xa3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x85,0x7b,0x7c,0x6b,0x00,0x5d,0x7c,0x7e,0x60,0x00,0x00,0x00,0x00
  ,0x00,0x00,0xa2,0x00,0x00,0x5c,0x9d,0x00,0x00,0x00,0x00,0x00,0x00,0x66,0xff,0xb6,0x00,0x00,0x00,0x56,0xff,0xc5,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x0b,0xe1,0xd8
  ,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x65,0xb5,0x47,0x00,0x4a,0xff,0xed,0x26,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x3f,0x4d,0x8a,0xef,0x86,0x02,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x4d,0xff,0x4f,0xba,0xff,0x29,0x00,0x00,0x00,0x00,0x00,0x00,0x55,0xff,0xe7,0xde,0xff,0xe4,0x5f,0x00,0x00,0x00,0x00,0x00,0x35,0xff,0xdd,0x65,0xc7
  ,0xe0,0xbe,0x4f,0x00,0x00,0x00,0x00,0x00,0x01,0x0a,0x00,0x00,0x00,0x87,0xe6,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x54,0xef,0xff,0xe8,0xc1,0xf5,0x74,0x00,0x00,0x00
  ,0x00,0x00,0x44,0xff,0xeb,0x19,0x00,0x00,0x8c,0xff,0xc2,0x04,0x00,0x00,0x00,0x00,0x5c,0xb3,0x03,0x00,0x00,0x81,0xa4,0x00,0x00,0x00,0x00,0x00,0x00,0x99,0xbb,0xa0
  ,0x65,0x43,0x2a,0x01,0x00,0x00,0x00,0x00,0x00,0x60,0xb3,0xac,0x1d,0x00,0x0d,0x98,0xac,0x1e,0x00,0x00,0x00,0x00,0x00,0x31,0x86,0x00,0x00,0x5d,0x99,0x2d,0x6c,0x51
  ,0x00,0x00,0x00,0x71,0xff,0xb0,0x00,0x00,0x00,0x4e,0xff,0xca,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0xe2,0xd8,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x17,0xd4,0xff,0x6c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x22,0xdd,0xdd,0xf6,0xea,0x50,0x00,0x00,0x00,0x00,0x00,0x00,0x19,0xe6,0x8f,0x00,0xc5,0xff,0x29,0x00
  ,0x00,0x00,0x00,0x00,0x00,0xbb,0xd2,0x26,0x0b,0x51,0xee,0xf5,0x40,0x00,0x00,0x00,0x00,0x4e,0xff,0xef,0xed,0x99,0x8f,0xf1,0xfa,0x52,0x00,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x00,0x0f,0xe5,0x9e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x95,0xff,0xff,0xff,0xff,0xbc,0x22,0x00,0x00,0x00,0x00,0x10,0xd8,0xff,0xa6,0x33,0x61,0xee,0xff
  ,0xc5,0x04,0x00,0x00,0x00,0x00,0x69,0xb3,0x0a,0x00,0x00,0x8a,0xa3,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0x96,0xbb,0xbb,0xbb,0xbb,0xbb,0x79,0x00,0x00,0x00,0x00,0x00
  ,0x91,0xa7,0x00,0x00,0x00,0x9f,0x48,0x00,0x00,0x00,0x00,0x00,0x00,0x8a,0x28,0x00,0x00,0x58,0xb1,0x86,0x69,0xb3,0x89,0x00,0x00,0x6b,0xff,0xb2,0x00,0x00,0x00,0x52
  ,0xff,0xc8,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x0b,0xe2,0xd8,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0xb6,0xff,0x7e,0x00,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x0b,0x0e,0x28,0xd5,0xf1,0x41,0x00,0x00,0x00,0x00,0x03,0xac,0xc8,0x00,0x00,0xc3,0xff,0x1c,0x00,0x00,0x00,0x00,0x00,0x00,0x62,0x47,0x00,0x00,0x00
  ,0xa2,0xff,0x9b,0x00,0x00,0x00,0x00,0x4f,0xff,0xff,0x74,0x00,0x00,0x7b,0xff,0xbf,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0xff,0x5f,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x00,0x6a,0xe8,0xad,0x70,0xbe,0xff,0xff,0xa8,0x01,0x00,0x00,0x00,0x00,0x3f,0xd9,0xff,0xff,0xec,0xc3,0xff,0xb9,0x01,0x00,0x00,0x00,0x00,0x7c,0xb3,0x52,0x00
  ,0x5a,0xb3,0xa2,0x1d,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x3b,0x6d,0xbb,0xbb,0x28,0x00,0x00,0x00,0x00,0x3e,0xb3,0x43,0x00,0x28,0xb3,0x00,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x9b,0x00,0x00,0x00,0x5b,0xa7,0x00,0x00,0x60,0xb3,0x00,0x00,0x56,0xff,0xc1,0x01,0x00,0x00,0x60,0xff,0xb5,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0b
  ,0xe2,0xd8,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xa4,0xfa,0x65,0x00,0x2e,0x33,0x00,0x00,0x00,0x00,0x04,0x83,0xa7,0x1d,0x00,0x00,0x86,0xff,0xa2,0x00
  ,0x00,0x00,0x00,0x51,0xff,0xbd,0x90,0x95,0xe2,0xff,0xa4,0x86,0x07,0x00,0x00,0x00,0x03,0x7e,0xb0,0x29,0x00,0x00,0x7c,0xff,0xae,0x00,0x00,0x00,0x00,0x3b,0xff,0xf0
  ,0x20,0x00,0x00,0x3c,0xff,0xdb,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0xbc,0xff,0x34,0x00,0x00,0x00,0x00,0x00,0x00,0x24,0xf3,0xc2,0x03,0x00,0x03,0x56,0xe7,0xe6
  ,0x0c,0x00,0x00,0x00,0x00,0x00,0x13,0x53,0x64,0x2c,0x5f,0xff,0x9a,0x00,0x00,0x00,0x00,0x00,0x95,0xae,0xb3,0xb3,0x8d,0x83,0xb3,0x8d,0x00,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x56,0xbb,0x47,0x00,0x00,0x00,0x00,0x00,0xa9,0x92,0x00,0x82,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x6b,0x60,0x00,0x00,0x00,0x5e,0x9b,0x00
  ,0x00,0x41,0xb3,0x00,0x00,0x26,0xfa,0xdf,0x08,0x00,0x00,0x80,0xff,0x87,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0xe2,0xd8,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  ,0x00,0x88,0xdc,0x3b,0x00,0x00,0xb9,0x93,0x00,0x00,0x00,0x00,0x27,0xff,0xff,0x67,0x00,0x00,0x73,0xff,0xb5,0x00,0x00,0x00,0x00,0x47,0xb0,0xb9,0xbe,0xc0,0xe9,0xff
  ,0xc8,0xaf,0x0a,0x00,0x00,0x00,0x1a,0xf8,0xff,0x6e,0x00,0x00,0x86,0xff,0xa3,0x00,0x00,0x00,0x00,0x14,0xe8,0xf1,0x1b,0x00,0x00,0x38,0xff,0xd1,0x06,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x28,0xf5,0xee,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x4c,0xff,0x80,0x00,0x00,0x00,0x00,0xac,0xee,0x0e,0x00,0x00,0x00,0x00,0x56,0x9f,0x2c,0x00,0x00
  ,0x95,0xff,0x5e,0x00,0x00,0x00,0x00,0x00,0xa4,0x49,0x30,0x2c,0x00,0x00,0x16,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x30,0xbb,0x2b,0x00,0x00
  ,0x00,0x00,0x00,0x65,0xb3,0x54,0xa9,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x86,0x00,0x00,0x00,0x00,0x5c,0x9b,0x00,0x00,0x47,0xb3,0x00,0x00,0x01,0xb4,0xff,0x42,0x00
  ,0x00,0xc5,0xfa,0x31,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xe3,0xd8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x63,0xff,0x97,0x48,0x4a,0x5d,0xee,0x79,0x00,0x00
  ,0x00,0x00,0x21,0xff,0xcd,0x15,0x00,0x00,0x9f,0xff,0x8d,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc5,0xff,0x1a,0x00,0x00,0x00,0x00,0x00,0x15,0xf3,0xcf,0x17
  ,0x00,0x01,0xc7,0xff,0x60,0x00,0x00,0x00,0x00,0x00,0x99,0xff,0x5c,0x00,0x00,0x72,0xff,0x90,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5e,0xff,0xe3,0x0c,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x2f,0xff,0xb5,0x00,0x00,0x00,0x0b,0xd9,0xb8,0x02,0x00,0x00,0x00,0x03,0xce,0xff,0x8e,0x00,0x1c,0xe7,0xda,0x11,0x00,0x00,0x00,0x00,0x04,0xb3,0x4a
  ,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x9e,0x2a,0x00,0x00,0x00,0x00,0x90,0x9c,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0xb3,0xb3,0x82,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x6e,0xa5,0x00,0x00,0x53,0xb3,0x00,0x00,0x00,0x30,0xe4,0xda,0x5c,0x8f,0xff,0x81,0x00,0x00,0x00,0x00,0x00,0x00,0x16
  ,0x88,0x9c,0xff,0xff,0x96,0x8c,0x23,0x00,0x00,0x00,0x00,0x42,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x68,0x00,0x00,0x00,0x00,0x02,0xaa,0xdf,0x64,0x4c,0x82,0xff,0xd5
  ,0x22,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3b,0x91,0xf6,0xff,0xa9,0x4f,0x00,0x00,0x00,0x00,0x01,0x95,0xe4,0x6d,0x58,0xad,0xff,0xa9,0x06,0x00,0x00,0x00,0x00,0x00
  ,0x22,0xdd,0xe7,0x65,0x69,0xed,0xd2,0x1b,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x72,0xff,0xdc,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x9a,0xff,0xa5,0x59,0x65,0xc5
  ,0xe7,0x34,0x00,0x00,0x00,0x00,0x02,0xac,0xff,0x9a,0x5d,0xd0,0xed,0x46,0x00,0x00,0x00,0x00,0x00,0x00,0xb3,0x55,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  ,0x00,0xa7,0xbb,0x72,0x47,0x59,0xa1,0x9c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x8e,0xb3,0x2a,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x45,0x9a
  ,0x9d,0x7a,0x00,0x4a,0x9c,0x82,0x00,0x00,0x00,0x36,0xaf,0xd4,0xc9,0x68,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1a,0xae,0xb3,0xa5,0xa5,0xb3,0xb2,0x2d,0x00,0x00,0x00
  ,0x00,0x4e,0xa6,0xa3,0xa5,0xa6,0xa6,0xa6,0xa3,0x37,0x00,0x00,0x00,0x00,0x00,0x0b,0x82,0xc7,0xd1,0xcf,0x8f,0x1f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x4d,0xb4
  ,0xa7,0xa4,0xb1,0x68,0x00,0x00,0x00,0x00,0x00,0x06,0x7c,0xcd,0xd4,0xc4,0x71,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x2b,0xa6,0xd4,0xd3,0x9d,0x21,0x00,0x00,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x35,0xcc,0x8c,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x6f,0xc4,0xd4,0xd2,0xa7,0x32,0x00,0x00,0x00,0x00,0x00,0x00,0x1d,0x9e,0xce
  ,0xd3,0xab,0x39,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x34,0x76,0xa1,0xad,0x9c,0x62,0x03,0x00,0x00
  ,0x00,0x00,0x00,0x00,0x00,0x00,0x14,0x57,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};




void plot_big_char(int xp,int yp,u8 chr,u8 char_plot_width=CHAR_PLOT_WIDTH){ 
  int xo=chr*CHAR_IMAGE_WIDTH;
  for(int y=0;y<CHAR_PLOT_HEIGHT;y++){
    for(int x=0;x<char_plot_width;x++){
      u32 c=big_font[xo+x+y*CHAR_IMAGE_STRIDE];
      c=c+(c<<8)+(c<<16);
      gcol=c; 
      p(x+xp,y+yp);
    }
  }
}



#define H_TUBE2 96
#define US_READING_PLOT_X 10
#define US_READING_PLOT_Y 73


#define US_READING_uSv_PLOT_X (US_READING_PLOT_X+75)

void drawit(){
  draw_tube(0  ,0  ,64,64,0);
  draw_tube(64 ,0  ,64,64,1);
  draw_tube(0  ,H_TUBE2 ,64,64,2);
  draw_tube(64 ,H_TUBE2 ,64,64,3);
  // plot main averaged reading number in big font
  float mean_us=0;
  for(int i=0;i<NUM_SBM20S;i++){
    mean_us+=microsieverts[i];
  }
  mean_us*=(1.0f/NUM_SBM20S);
  char rtt[16];
  sprintf(rtt,"%8.3f",mean_us);
  int xp=US_READING_PLOT_X;
  for(int i=0;i<8;i++){
    u8 c=rtt[i];
    if (c=='.'){
      int x=US_READING_PLOT_X+i*10+1;
      int y=US_READING_PLOT_Y+11;
      gcol=white_cr;
      p(x,y);
      p(x+1,y);
      p(x,y+1);
      p(x+1,y+1);
      xp+=5;
    }else{
      if (c!=' '){
        plot_big_char(xp,US_READING_PLOT_Y,rtt[i]-'0');
      }
      xp+=CHAR_PLOT_WIDTH;
    }
  }
}


void draw_background(){
  draw_tube_background(0  ,0  ,64,64,0);
  draw_tube_background(64 ,0  ,64,64,1);
  draw_tube_background(0  ,H_TUBE2 ,64,64,2);
  draw_tube_background(64 ,H_TUBE2 ,64,64,3);
  plot_big_char(US_READING_uSv_PLOT_X+1,US_READING_PLOT_Y+4,10);
  plot_big_char(US_READING_uSv_PLOT_X+CHAR_PLOT_WIDTH,US_READING_PLOT_Y,11);
  plot_big_char(US_READING_uSv_PLOT_X+CHAR_PLOT_WIDTH*2+1,US_READING_PLOT_Y+2,12);
  plot_big_char(US_READING_uSv_PLOT_X+CHAR_PLOT_WIDTH*3-1,US_READING_PLOT_Y+5,13,13);

}


